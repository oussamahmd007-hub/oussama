<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OUSSOCASH | المؤسسة المالية المتكاملة</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <style>
        :root {
            --navy: #001A33;
            --royal: #0052CC;
            --soft-blue: #F0F5FF;
            --white: #FFFFFF;
            --border: #E2E8F0;
            --text-dark: #0F172A;
            --text-light: #64748B;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--soft-blue); 
            margin: 0; color: var(--text-dark); 
            line-height: 1.6;
        }

        /* Modal Premium Design */
        #ousso-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 9999;
        }
        .ousso-modal {
            background: var(--white); padding: 40px; border-radius: 16px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .ousso-modal h2 { color: var(--navy); font-weight: 900; margin-bottom: 10px; }
        .ousso-modal button { 
            background: var(--royal); color: white; border: none;
            padding: 14px 40px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%;
        }

        /* Branding Header */
        header { 
            background: var(--navy); padding: 80px 20px 120px; 
            text-align: center; color: var(--white);
        }
        .header-logo { font-size: 40px; font-weight: 900; letter-spacing: 1px; margin: 0; }
        .header-tagline { font-size: 10px; text-transform: uppercase; letter-spacing: 5px; opacity: 0.6; margin-top: 8px; font-weight: 600; }

        /* Smooth Navigation Bar */
        .nav-container {
            max-width: 600px; margin: -40px auto 30px; padding: 0 15px;
        }
        .nav-bar {
            display: flex; background: var(--white); padding: 8px;
            border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            overflow-x: auto; gap: 5px;
        }
        .nav-btn {
            flex: 1; padding: 12px 20px; border: none; background: none;
            color: var(--text-light); font-family: 'Cairo'; font-weight: 700;
            font-size: 13px; cursor: pointer; border-radius: 12px;
            white-space: nowrap; transition: 0.3s;
        }
        .nav-btn.active { background: var(--royal); color: var(--white); }

        .content-area { max-width: 600px; margin: 0 auto 100px; padding: 0 20px; }

        /* Card Section Styles */
        .section-card { 
            background: var(--white); border-radius: 20px; padding: 35px; 
            margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0, 26, 51, 0.03);
            border: 1px solid var(--border);
        }
        .card-title { font-size: 20px; font-weight: 900; color: var(--navy); margin-bottom: 25px; }

        /* Realistic Live Visitor Component */
        .live-status {
            display: inline-flex; align-items: center; gap: 10px;
            background: var(--soft-blue); padding: 8px 16px; border-radius: 50px;
            font-size: 12px; font-weight: 700; color: var(--royal); margin-bottom: 20px;
        }
        .pulse-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; position: relative; }
        .pulse-dot::after { content: ''; position: absolute; width: 100%; height: 100%; background: #10B981; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(3); opacity: 0; } }

        /* Statistics Grid */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px; }
        .stat-item { padding: 20px; background: var(--soft-blue); border-radius: 15px; text-align: center; }
        .stat-value { display: block; font-size: 22px; font-weight: 900; color: var(--navy); }
        .stat-label { font-size: 10px; font-weight: 700; color: var(--text-light); text-transform: uppercase; margin-top: 5px; }

        /* Form Design */
        .field-group { margin-bottom: 22px; }
        .field-label { display: block; font-size: 12px; font-weight: 800; color: var(--navy); margin-bottom: 10px; }
        input, select {
            width: 100%; padding: 16px; border: 1px solid var(--border);
            border-radius: 12px; font-family: 'Cairo'; font-size: 14px; font-weight: 600;
            background: #FAFBFC; transition: 0.3s;
        }
        input:focus { border-color: var(--royal); background: white; box-shadow: 0 0 0 4px rgba(0, 82, 204, 0.05); }

        /* Upload Area */
        .upload-box {
            border: 2px dashed var(--border); border-radius: 15px; padding: 40px 20px;
            text-align: center; cursor: pointer; transition: 0.3s; background: #FAFBFC;
        }
        .upload-box:hover { border-color: var(--royal); background: var(--soft-blue); }
        #preview-img { width: 100%; max-height: 250px; object-fit: contain; border-radius: 10px; margin-top: 15px; display: none; }

        /* Action Buttons */
        .btn-action {
            width: 100%; padding: 20px; border-radius: 15px; border: none;
            background: var(--royal); color: white; font-weight: 900; font-size: 16px;
            cursor: pointer; transition: 0.4s; box-shadow: 0 10px 20px rgba(0, 82, 204, 0.2);
        }
        .btn-action:disabled { background: var(--text-light); opacity: 0.5; }

        /* Support Center */
        .support-card {
            border: 1px solid var(--border); padding: 20px; border-radius: 12px;
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .support-card:hover { border-color: var(--royal); background: var(--soft-blue); }
        .support-info h4 { margin: 0; font-size: 14px; font-weight: 800; }
        .support-info p { margin: 5px 0 0; font-size: 11px; color: var(--text-light); }

        /* Promocode Card */
        .promo-ticket {
            background: var(--navy); color: white; border-radius: 20px; padding: 40px;
            text-align: center; border: 1px solid var(--royal);
        }
        .promo-val {
            font-size: 36px; font-weight: 900; letter-spacing: 8px; margin: 20px 0;
            padding: 10px; border: 1px dashed rgba(255,255,255,0.3);
        }

        .hidden { display: none; }
        
        /* Admin Access Button */
        .admin-trigger { text-align: center; padding: 20px; font-size: 9px; opacity: 0.2; font-weight: 900; color: var(--navy); cursor: pointer; }
    </style>
</head>
<body>

    <div id="ousso-modal-overlay">
        <div class="ousso-modal">
            <h2 id="modal-h">إشعار النظام</h2>
            <p id="modal-p">تمت معالجة طلبك بنجاح.</p>
            <button onclick="closeModal()">إغلاق النافذة</button>
        </div>
    </div>

    <header>
        <h1 class="header-logo">OUSSOCASH</h1>
        <div class="header-tagline">Global Financial Liquidity Agency</div>
    </header>

    <div class="nav-container">
        <nav class="nav-bar">
            <button class="nav-btn active" onclick="showSec('trade', this)">المعاملات</button>
            <button class="nav-btn" onclick="showSec('about', this)">المؤسسة</button>
            <button class="nav-btn" onclick="showSec('promo', this)">بونص</button>
            <button class="nav-btn" onclick="showSec('help', this)">الدعم</button>
            <button class="nav-btn" onclick="showSec('orders', this)">السجل</button>
        </nav>
    </div>

    <main class="content-area">
        
        <section id="about" class="section-card hidden">
            <div class="live-status">
                <span class="pulse-dot"></span>
                العملاء النشطون الآن: <span id="visitor-count">4,820</span>
            </div>
            <div class="card-title">لماذا تختار OUSSOCASH</div>
            <p style="font-size: 14px; color: var(--text-light);">بصفتنا مؤسسة مالية متخصصة، نلتزم بتوفير بيئة تداول آمنة وسرعة فائقة في معالجة طلبات السيولة الرقمية، مع ضمان حماية كاملة للأموال بنسبة 100%.</p>
            
            <div class="stat-grid">
                <div class="stat-item"><span class="stat-value">+50,000</span><label class="stat-label">عملية منفذة</label></div>
                <div class="stat-item"><span class="stat-value">100%</span><label class="stat-label">ضمان استرداد</label></div>
                <div class="stat-item"><span class="stat-value">1 دقيقة</span><label class="stat-label">وقت التنفيذ</label></div>
                <div class="stat-item"><span class="stat-value">24/7</span><label class="stat-label">خدمة مستمرة</label></div>
            </div>
        </section>

        <section id="trade" class="section-card">
            <div class="card-title">إنشاء طلب جديد</div>
            
            <div class="field-group">
                <label class="field-label">نوع العملية المالية</label>
                <select id="opType" onchange="toggleFormView()">
                    <option value="deposit">إيداع رصيد (شحن)</option>
                    <option value="withdraw">سحب رصيد (كاش)</option>
                </select>
            </div>

            <div id="dep-logic">
                <div class="field-group">
                    <label class="field-label">اختيار المؤسسة البنكية</label>
                    <select id="depBank" onchange="fetchWallet()">
                        <option value="">-- اختر البنك للمتابعة --</option>
                        <option value="bankily">Bankily</option>
                        <option value="masrivi">Masrivi</option>
                        <option value="sedad">Sedad</option>
                    </select>
                </div>

                <div id="wallet-info" class="hidden">
                    <div style="background: var(--soft-blue); padding: 25px; border-radius: 12px; text-align: center; border: 1px solid var(--royal); margin-bottom: 20px;">
                        <span style="font-size: 11px; font-weight: 800; color: var(--text-light); display: block;">رقم حساب وكالة OUSSOCASH</span>
                        <b id="activeNum" style="font-size: 26px; color: var(--navy); letter-spacing: 1px;">00000000</b>
                        <div onclick="copyData('activeNum')" style="color: var(--royal); font-size: 12px; font-weight: 900; margin-top: 10px; cursor: pointer;">نسخ الرقم</div>
                    </div>

                    <div class="field-group">
                        <label class="field-label">وثيقة إثبات التحويل</label>
                        <div class="upload-box" onclick="document.getElementById('fileInp').click()">
                            <span id="upTxt">اضغط هنا لإرفاق صورة التحويل</span>
                            <input type="file" id="fileInp" class="hidden" accept="image/*" onchange="handleFile(this)">
                            <img id="preview-img">
                        </div>
                    </div>
                </div>
            </div>

            <div id="with-logic" class="hidden">
                <div style="background: #FEF2F2; color: #991B1B; padding: 15px; border-radius: 10px; font-size: 12px; font-weight: 700; margin-bottom: 20px; border: 1px solid #FCA5A5;">
                    ملاحظة: يتم تسليم النقد في مقر الوكالة الرسمي (مقاطعة الرياض).
                </div>
                <div class="field-group">
                    <label class="field-label">كود السحب البنكي</label>
                    <input type="text" id="wCode" placeholder="أدخل الكود الصادر من التطبيق">
                </div>
            </div>

            <div class="field-group">
                <label class="field-label">بيانات الحساب</label>
                <input type="text" id="accId" placeholder="رقم المعرف الرقمي (ID)" style="margin-bottom: 12px;">
                <input type="number" id="amount" placeholder="القيمة المالية المطلوبة" style="margin-bottom: 12px;">
                <input type="number" id="userPhone" placeholder="رقم هاتفك الرسمي">
            </div>

            <button class="btn-action" id="subBtn" onclick="sendToFirebase()">تأكيد وإرسال الطلب الآن</button>
        </section>

        <section id="promo" class="section-card hidden">
            <div class="card-title">برنامج الولاء</div>
            <div class="promo-ticket">
                <p style="font-size: 12px; font-weight: 700; opacity: 0.8;">مكافأة التسجيل الأولى 200%</p>
                <div class="promo-val" id="pCode">OUSSO</div>
                <button onclick="copyData('pCode')" style="background: var(--royal); color: white; border: none; padding: 10px 30px; border-radius: 8px; font-weight: 800; cursor: pointer;">نسخ الرمز</button>
                <p style="font-size: 11px; margin-top: 30px; line-height: 2;">تأكد من إدخال الرمز الترويجي أثناء إنشاء حسابك الجديد للحصول على المكافأة فور الإيداع الأول عبر وكالتنا.</p>
            </div>
        </section>

        <section id="help" class="section-card hidden">
            <div class="card-title">مركز المساعدة والضمان</div>
            <p style="font-size: 13px; color: var(--text-light); margin-bottom: 25px;">نحن هنا لضمان انسيابية تعاملاتكم. اختر وسيلة التواصل المناسبة:</p>
            
            <div class="support-card" onclick="openWa()">
                <div class="support-info">
                    <h4>مستشار الدعم المباشر</h4>
                    <p>استجابة احترافية فورية (متصل الآن)</p>
                </div>
                <div style="font-size: 12px; color: var(--royal); font-weight: 900;">مراسلة</div>
            </div>

            <div class="support-card">
                <div class="support-info">
                    <h4>الأمان والشفافية</h4>
                    <p>نظام OUSSOCASH مشفر بالكامل لحماية بياناتك</p>
                </div>
            </div>
        </section>

        <section id="orders" class="section-card hidden">
            <div class="card-title">متابعة الطلبات</div>
            <div id="historyList" style="text-align: center; color: var(--text-light); font-size: 13px;">لا توجد سجلات حالية.</div>
        </section>

        <div class="admin-trigger" onclick="loginAdmin()">ADMIN CONTROL PANEL</div>

    </main>

    <script>
        // --- Firebase Init ---
        const firebaseConfig = { 
            databaseURL: "https://oussocash-default-rtdb.firebaseio.com",
            storageBucket: "oussocash-default-rtdb.appspot.com" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const st = firebase.storage();

        // --- Realistic Visitor Counter Logic ---
        let baseVisitors = 4820;
        function smoothVisitorCounter() {
            // إضافة أو طرح رقم صغير (بين 5 و 12)
            const change = Math.floor(Math.random() * 8) + 5;
            const up = Math.random() > 0.45; // فرصة أكبر قليلاً للزيادة لإعطاء انطباع بالنمو
            
            if(up && baseVisitors < 9900) baseVisitors += change;
            else if(!up && baseVisitors > 1200) baseVisitors -= change;
            
            document.getElementById('visitor-count').innerText = baseVisitors.toLocaleString();
        }
        setInterval(smoothVisitorCounter, 3500); // تحديث كل 3.5 ثانية

        // --- App Settings Management ---
        let remoteSettings = {};
        db.ref('settings').on('value', snap => {
            remoteSettings = snap.val() || { wallets: {}, whatsapp: "222" };
        });

        // --- UI Navigation ---
        function showSec(id, btn) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(id === 'orders') renderHistory();
            window.scrollTo(0,0);
        }

        function toggleFormView() {
            const isDep = document.getElementById('opType').value === 'deposit';
            document.getElementById('dep-logic').classList.toggle('hidden', !isDep);
            document.getElementById('with-logic').classList.toggle('hidden', isDep);
        }

        function fetchWallet() {
            const bank = document.getElementById('depBank').value;
            if(bank) {
                document.getElementById('activeNum').innerText = remoteSettings.wallets[bank] || "غير متوفر";
                document.getElementById('wallet-info').classList.remove('hidden');
            }
        }

        // --- Helper Functions ---
        function handleFile(inp) {
            if (inp.files && inp.files[0]) {
                const r = new FileReader();
                r.onload = e => {
                    const img = document.getElementById('preview-img');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.getElementById('upTxt').style.display = 'none';
                };
                r.readAsDataURL(inp.files[0]);
            }
        }

        function copyData(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText);
            showModal("تم النسخ", "يمكنك الآن استخدام البيانات لإتمام العملية.");
        }

        function openWa() {
            window.open(`https://wa.me/${remoteSettings.whatsapp}`, '_blank');
        }

        function showModal(h, p) {
            document.getElementById('modal-h').innerText = h;
            document.getElementById('modal-p').innerText = p;
            document.getElementById('ousso-modal-overlay').style.display = 'flex';
        }
        function closeModal() { document.getElementById('ousso-modal-overlay').style.display = 'none'; }

        // --- Database Logic ---
        async function sendToFirebase() {
            const btn = document.getElementById('subBtn');
            const type = document.getElementById('opType').value;
            const phone = document.getElementById('userPhone').value;
            const amount = document.getElementById('amount').value;
            const accId = document.getElementById('accId').value;
            const file = document.getElementById('fileInp').files[0];

            if(!phone || !amount || !accId) return showModal("تنبيه", "يرجى إدخال كافة البيانات المطلوبة.");
            
            btn.disabled = true;
            btn.innerText = "جاري التأمين والإرسال...";

            try {
                let imgUrl = "-";
                if(type === 'deposit' && file) {
                    const ref = st.ref(`vault/${Date.now()}_${phone}`);
                    await ref.put(file);
                    imgUrl = await ref.getDownloadURL();
                }

                await db.ref('orders').push({
                    type, phone, amount, accId, 
                    proof: imgUrl, 
                    wCode: document.getElementById('wCode').value || "-",
                    status: "pending",
                    date: new Date().toLocaleString('ar-SA')
                });

                localStorage.setItem('my_phone', phone);
                showModal("تم القبول", "استلمنا طلبك بنجاح. سيتم التنفيذ خلال لحظات.");
                location.reload();

            } catch (e) {
                showModal("خطأ", "فشل الاتصال بالخادم الرئيسي.");
                btn.disabled = false;
            }
        }

        function renderHistory() {
            const p = localStorage.getItem('my_phone');
            const list = document.getElementById('historyList');
            if(!p) return;

            db.ref('orders').orderByChild('phone').equalTo(p).limitToLast(5).on('value', snap => {
                list.innerHTML = "";
                if(!snap.exists()) return list.innerHTML = "لا توجد معاملات سابقة.";
                snap.forEach(c => {
                    const o = c.val();
                    const st = o.status === 'done' ? 'مكتمل' : 'قيد المعالجة';
                    list.innerHTML += `
                        <div style="background:var(--soft-blue); padding:15px; border-radius:12px; margin-bottom:10px; text-align:right; border-right:4px solid var(--royal);">
                            <b>${o.type === 'deposit' ? 'إيداع' : 'سحب'} - ${o.amount} MRU</b><br>
                            <small>${o.date} | الحالة: ${st}</small>
                        </div>
                    `;
                });
            });
        }

        // --- Admin Access ---
        function loginAdmin() {
            const pw = prompt("ADMIN PASSCODE:");
            if(pw === "1234") {
                // الكود هنا يفتح واجهة الإدارة كما في النسخ السابقة
                alert("لوحة التحكم متاحة في الخلفية، جاري توجيهك.");
                // يمكن تفعيل واجهة الأدمن بنفس منطق النسخ السابقة
            }
        }
    </script>
</body>
</html>
